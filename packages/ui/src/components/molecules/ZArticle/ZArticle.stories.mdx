import { Meta, Props, Story, Preview } from '@storybook/addon-docs/blocks';
import { withKnobs, text, object } from '@storybook/addon-knobs';
import { withA11y } from '@storybook/addon-a11y';
import axios from 'axios';
import ZArticle from './ZArticle.vue';

<Meta title="Molecules/Article" component={ZArticle} decorators={[withKnobs, withA11y]}/>

# Article

<Preview>
  <Story name="Common">
    {{
        components: { ZArticle },
        props: {
          tag: {
            default: text('tag', 'div')
          },
          thumbnail: {
            default: text('thumbnail', 'https://demo.przemyslawspaczek.pl/wp-content/uploads/2020/08/fot.-ZHP-_-Karolina-Piotrowska-18.jpg')
          },
          title: {
            default: text('title', 'Nabór instruktorów do wydziałów i zespołów Głównej Kwatery ZHP: Podejmij służbę!')
          },
          author: {
            default: object('author', {value: 'Przemysław Spaczek', to: '#'})
          },
          date: {
            default: text('date', '24.08.2020')
          }
        },
        template: `<ZArticle
          :thumbnail="thumbnail"
          :title="title"
          to="https://zhp.pl"
          :author="author"
          :date="date"
          style="width: 250px"
        />`,
    }}
  </Story>
</Preview>

<Preview>
  <Story name="Grid">
    {{
        components: { ZArticle },
        data() {
          return {
            posts: [],
            authors: {},
          }
        },
        template: `<div style="display: grid; grid-template-columns: repeat(4, 1fr); column-gap: 20px; row-gap: 20px; max-width: 1071px; margin: 0 auto">
          <ZArticle
            v-for="(post, index) in posts"
            :key="post.id"
            :thumbnail="post.futured_media"
            :title="post.title.rendered"
            :to="post.link"
            :author="post.author"
            :sticky="post.sticky"
            :date="post.date"
            :class="{'z-article--highlighted': post.sticky, 'z-article--primary': index === 0}"
          />
        </div>`,
      async mounted(){
        // todo: keep it in vuex
        const { API_URL } = process.env;
        let users = await axios.get(`${API_URL}/users`)
        users = users.data.reduce((accumulator, user) => ({...accumulator, [user.id]: {name: user.name, to: user.link}}),{});
        const {data} =  await axios.get(`${API_URL}/posts?per_page=16`)
        // todo: create scoped-slot component
        const postWithMedia = await Promise.all(data.map(async(post) => {
          const {data} = await axios.get(`${API_URL}/media/${post.featured_media}`)
          return {...post, futured_media: data.guid.rendered}
        }))
        // todo: create scoped-slot component
        const postWithAuthors = postWithMedia.map((post) => {
          return {...post, author: users[post.author]}
        })
        this.posts = postWithAuthors
      }
    }}
  </Story>
</Preview>

#Props

<Props of={ZArticle} />
